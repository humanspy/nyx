[build]
  builder = "NIXPACKS"

[deploy]
  startCommand = "node packages/api/index.js"

[[services]]
  name = "nyx-backend"
  source = "backend"
  [services.build]
    buildCommand = "npm install"
  [services.deploy]
    startCommand = "node src/server.js"
    healthcheckPath = "/health"
    restartPolicyType = "ON_FAILURE"
    restartPolicyMaxRetries = 5
  [services.variables]
    NODE_ENV = "production"

[[services]]
  name = "nyx-frontend"
  source = "frontend"
  [services.build]
    buildCommand = "npm install && npm run build"
  [services.deploy]
    startCommand = "npx serve -s dist -l $PORT"
    healthcheckPath = "/"
  [services.variables]
    NODE_ENV = "production"

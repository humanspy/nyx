[build]
  builder = "NIXPACKS"

[[services]]
  name = "nyx-backend"
  source = "backend"
  [services.build]
    buildCommand = "npm install"
  [services.deploy]
    startCommand = "node src/index.js"
    healthcheckPath = "/api/health"
    restartPolicyType = "ON_FAILURE"
    restartPolicyMaxRetries = 5
  [services.variables]
    PORT = "3001"
    NODE_ENV = "production"

[[services]]
  name = "nyx-frontend"
  source = "frontend"
  [services.build]
    buildCommand = "npm install && npm run build"
  [services.deploy]
    startCommand = "npx serve -s dist -l 3000"
    healthcheckPath = "/"
  [services.variables]
    NODE_ENV = "production"
